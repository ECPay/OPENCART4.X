綠界科技 OpenCart 模組
===============

提供合作特店以及個人賣家使用開放原始碼商店系統時，無須自行處理複雜的檢核，直接透過安裝設定外掛套件，便可以較快速的方式介接綠界系統。


目錄
-----------------
* [支援版本](#支援版本)
* [安裝](#安裝)
    1. [環境需求](#環境需求)
    2. [安裝模組](#安裝模組)
* [設定](#設定)
    1. [金流](#金流)
    2. [電子發票](#電子發票)
    3. [物流](#物流)
* [技術支援](#技術支援)



支援版本
-----------------
| OpenCart    | PHP         |
| :---------: | :---------: |
|  4.0.2.3    | 8.1         |


安裝
-----------------
#### 環境需求
請確認已安裝 PHP `curl` 模組。
安裝與設定: https://www.php.net/manual/en/curl.installation.php

#### 安裝模組
`購物車後台` -> `擴充模組安裝(Extension Installer)` -> 上傳 `ecpay.ocmod.zip` -> 清單出現 `ECPay Ecommerce for OpenCart` 模組後點擊安裝。

※ 安裝 `ECPay Ecommerce for OpenCart` 需花費一點時間，請等安裝完成後再繼續其他動作，以免安裝不完全導致模組無法正常使用。

設定
-----------------

#### 金流

**啟用**
- `購物車後台` -> `擴充模組(Extensions)` -> `付款模組(Payments)` -> `綠界金流模組`，點選右邊 `安裝` 按鈕。
- `購物車後台` -> `擴充模組(Extensions)` -> `付款模組(Payments)` -> `綠界金流模組`，點選右邊 `編輯` 按鈕。
- 至 [綠界管理後台](https://vendor.ecpay.com.tw/)，查詢以下資訊並回填。

|  購物車後台欄位名稱 | 綠界管理後台欄位名稱  |
| :------------: | :------------: |
|  商店代號(Merchant ID) | 商店代號 |
|  金鑰(Hash Key) |  介接 HashKey |
|  向量(Hash IV) |  介接 HashIV |

**注意事項**
- 請注意 Hash Key 與 Hash IV 內容不可包含空白。
- 商店代號 `3002607` 為測試代號，請勿使用於正式營運環境。
- 建議使用複製 + 貼上回填資訊。
- 將狀態設為 `啟用`，其他選項請依需求設定 *(部分付款功能僅適用於特約商店)*，按下 `儲存` 完成設定。
- `貨到付款(COD)` 僅支援 `綠界超商取貨付款`。
- 要使用 `無卡分期 BNPL` 金額不可小於 3000 元或大於 30 萬元。
- 要使用 `歐付寶 TWQR` 金額不可小於 6 元或大於 49,999 元。

#### 電子發票

**啟用**
- `購物車後台` -> `擴充模組(Extensions)` -> `功能模組(Modules)` -> `綠界電子發票模組`，點選右邊 `安裝` 按鈕。
- `購物車後台` -> `擴充模組(Extensions)` -> `功能模組(Modules)` -> `綠界電子發票模組`，點選右邊 `編輯` 按鈕。
- 至 [綠界管理後台](https://vendor.ecpay.com.tw/)，查詢以下資訊並回填。

|  購物車後台欄位名稱 | 綠界管理後台欄位名稱  |
| :------------: | :------------: |
|  商店代號(Merchant ID) | 商店代號 |
|  金鑰(Hash Key) |  介接 HashKey |
|  向量(Hash IV) |  介接 HashIV |

**手動開立**
- `購物車後台` -> `銷售管理` -> `訂單管理` -> `訂單清單`，點選 `電子發票` 的 `產生` 按鈕。

**注意事項**
- 請注意 Hash Key 與 Hash IV 內容不可包含空白。
- 自動開立，請將 自動開立電子發票狀態設為 `啟用`。
- 將狀態設為 `啟用`， 按下 `儲存` 完成設定。
- 須搭配使用 `綠界金流模組` 付款方式才能使用 `綠界電子發票模組` 功能。

#### 物流

**啟用**
- `購物車後台` -> `擴充模組(Extensions)` -> `運送模組(Shipping)` -> `綠界物流模組`，點選右邊 `安裝` 按鈕。
- `購物車後台` -> `擴充模組(Extensions)` -> `運送模組(Shipping)` -> `綠界物流模組`，點選右邊 `編輯` 按鈕。
- 至 [綠界管理後台](https://vendor.ecpay.com.tw/)，查詢以下資訊並回填。

|  購物車後台欄位名稱 | 綠界管理後台欄位名稱  |
| :------------: | :------------: |
|  商店代號(Merchant ID) | 商店代號 |
|  金鑰(Hash Key) |  介接 HashKey |
|  向量(Hash IV) |  介接 HashIV |

**參數設定**
- 請根據您的申請資料輸入必要參數，1.商店代號(Merchant ID)、2.金鑰(Hash Key) 、3.向量(Hash IV)，並設定各運送方式的運費及狀態，最後再將一般設定的狀態改成啟用。

**變更門市**
- `購物車後台` -> `銷售管理` -> `訂單管理` -> `訂單清單` -> `運送方式`，點選 `變更門市` 按鈕。

**建立物流訂單**
- `購物車後台` -> `銷售管理` -> `訂單管理` -> `訂單清單` -> `運送方式`，點選 `建立物流訂單` 按鈕。

**列印物流單**
- 成功 `建立物流訂單` 後才能 `列印物流單`。
- `購物車後台` -> `銷售管理` -> `訂單管理` -> `訂單清單` -> `運送方式`，點選 `列印物流單` 按鈕。

**注意事項**
- 綠界物流模組安裝完成後，上述參數會帶入測試帳號為預設值，若您尚未取得廠商專屬帳號，請致電綠界科技，請勿使用於正式營運環境。
- 請注意 Hash Key 與 Hash IV 內容不可包含空白。
- 須搭配使用 `綠界金流模組` 付款方式才能使用 `綠界物流模組` 功能。
- 超商物流的商品金額限制範圍為 1~20000 元，超過時前台結帳頁會自動隱藏選項。
- 中華郵政的商品重量限 20 公斤，超過時前台結帳頁會自動隱藏選項。
- 提供兩種時區變更方式，解決時間差了 8 小時的問題。

  1. 安裝第三方套件，並從後台設定時區，下載連結如下方。
https://www.opencart.com/index.php?route=marketplace/extension/info&extension_id=16023&filter_license=0&filter_download_id=29&filter_rating=2

  2. 透過程式參數調整變更時區，找到 `/upload/system/config/default.php`，調整內容：
      ```
      $_['date_timezone'] = 'UTC';

      # 變更為
      $_['date_timezone']  = 'Asia/Taipei';
      ```

技術支援
-----------------
綠界技術客服信箱: techsupport@ecpay.com.tw
